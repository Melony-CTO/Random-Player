<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>🎵 Melony 랜덤 음악 플레이어</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    #trackTitle {
      margin-bottom: 10px;
      font-size: 1.5em;
    }

    .controls-wrapper {
      margin-top: 20px;
      display: flex;
      flex-direction: column; /* 수직 배치 */
      align-items: center; /* 가운데 정렬 */
      gap: 10px; /* 각 요소 간격 */
    }

    .custom-controls {
      display: flex;
      gap: 10px;
    }

    .custom-controls button,
    #toggleAuto {
      padding: 12px 25px;
      font-size: 16px;
      min-width: 120px;
      cursor: pointer;
    }
  </style>
  <link rel="manifest" href="/manifest.json">
</head>
<body>
  <h2 id="trackTitle">🎵 Melony 랜덤 음악 플레이어</h2>
  <audio id="player" playsinline>
    <source id="source" src="" type="audio/mpeg">
    브라우저가 오디오 태그를 지원하지 않습니다.
  </audio>

  <div class="controls-wrapper">
    <div class="custom-controls">
      <button id="playPauseButton">재생</button>
      <button id="nextButton">다음 곡</button>
    </div>
    <button id="toggleAuto">자동재생 OFF</button>
  </div>

  <script>
const tracks = [
  { id: 1, file: "00C1. Sunday Letters M.mp3", title: "Sunday Letters" },
  { id: 2, file: "00C10. If I Had Said It.mp3", title: "If I Had Said It" },
  { id: 3, file: "00C12. Did You Know I Loved You-M.mp3", title: "Did You Know I Loved You" },
  { id: 4, file: "00C13. Falling in Between - M.mp3", title: "Falling in Between" },
  { id: 5, file: "00C14. The Way We Pause – M.mp3", title: "The Way We Pause" },
  { id: 6, file: "00C15. Shared Mornings.mp3", title: "Shared Mornings" },
  { id: 7, file: "00C16. We Never Said Goodbye– M.mp3", title: "We Never Said Goodbye" },
  { id: 8, file: "00C17. Echoes Between Us-M.mp3", title: "Echoes Between Us" },
  { id: 9, file: "00C18. Close Enought.mp3", title: "Close Enought" },
  { id: 10, file: "00C19. If I'm in Your Day.mp3", title: "If I'm in Your Day" },
  { id: 11, file: "00C2. Told with Eyes M.mp3", title: "Told with Eyes" },
  { id: 12, file: "00C20. Steps Between the Silence-M.mp3", title: "Steps Between the Silence" },
  { id: 13, file: "00C3. Midnight Between Us-M.mp3", title: "Midnight Between Us" },
  { id: 14, file: "00C4. Tilted Heartbeat-M.mp3", title: "Tilted Heartbeat" },
  { id: 15, file: "00C5. Steps That MatchM.mp3", title: "Steps That Match" },
  { id: 16, file: "00C6. Letters in the Rain-M.mp3", title: "Letters in the Rain" },
  { id: 17, file: "00C7. Half a Step Behind-M.mp3", title: "Half a Step Behind" },
  { id: 18, file: "00C8. Almost Something-M.mp3", title: "Almost Something" },
  { id: 19, file: "00C9. Quiet Like a Song-M.mp3", title: "Quiet Like a Song" },
  { id: 20, file: "00D1-Only in My Mind.mp3", title: "Only in My Mind" },
  { id: 21, file: "00D2-What If We Stayed.mp3", title: "What If We Stayed" },
  { id: 22, file: "00D3-Every Time I Almost Spoke.mp3", title: "Every Time I Almost Spoke" },
  { id: 23, file: "00D4-Wish I Said Your Name.mp3", title: "Wish I Said Your Name" },
  { id: 24, file: "00D5-Lines I Never Crossed.mp3", title: "Lines I Never Crossed" },
  { id: 25, file: "00D6-What You Didn’t Say.mp3", title: "What You Didn’t Say" },
  { id: 26, file: "00c11. If You Were Me-M.mp3", title: "If You Were Me" }
];

let recent = [];
const recentLimitMinutes = 30;
let autoPlay = true;

const player = document.getElementById("player");
const source = document.getElementById("source");
const trackTitleDisplay = document.getElementById("trackTitle");
const playPauseButton = document.getElementById("playPauseButton");
const nextButton = document.getElementById("nextButton");
const autoPlayToggle = document.getElementById("toggleAuto");

function saveRecent(id) {
  const now = Date.now();
  recent.push({ id, time: now });
  recent = recent.filter(r => now - r.time <= recentLimitMinutes * 60 * 1000);
}

function pickRandomTrack() {
  const available = tracks.filter(t => !recent.some(r => r.id === t.id));
  if (available.length === 0) {
    recent = [];
    return pickRandomTrack();
  }
  const index = Math.floor(Math.random() * available.length);
  return available[index];
}

function loadTrack(track) {
  trackTitleDisplay.innerText = "🎵 " + track.title;
  source.src = track.file;
  player.load();
  playPauseButton.innerText = player.paused ? "재생" : "일시정지";
  if (autoPlay) {
    player.play().catch(error => {
      console.warn("Autoplay was prevented:", error);
      playPauseButton.innerText = "재생";
    });
  }
  saveRecent(track.id);
}

document.addEventListener("DOMContentLoaded", () => {
  const firstTrack = pickRandomTrack();
  loadTrack(firstTrack);
});

player.addEventListener("ended", () => {
  const nextTrack = pickRandomTrack();
  loadTrack(nextTrack);
});

player.addEventListener('play', () => {
  playPauseButton.innerText = "일시정지";
});
player.addEventListener('pause', () => {
  playPauseButton.innerText = "재생";
});

playPauseButton.addEventListener("click", () => {
  if (player.paused) {
    player.play().catch(error => console.warn("Play attempt failed:", error));
  } else {
    player.pause();
  }
});

nextButton.addEventListener("click", () => {
  const nextTrack = pickRandomTrack();
  loadTrack(nextTrack);
});

autoPlayToggle.addEventListener("click", () => {
  autoPlay = !autoPlay;
  autoPlayToggle.innerText = autoPlay ? "자동재생 OFF" : "자동재생 ON";
  if (autoPlay && player.paused) {
    player.play().catch(error => console.warn("Autoplay toggle play prevented:", error));
  }
});

player.addEventListener('error', (e) => {
  let errorMessage = "오디오 재생 중 오류가 발생했습니다.";
  if (e.target.error.code === 4) {
    errorMessage = "오디오 파일을 찾을 수 없거나 브라우저가 지원하지 않는 형식입니다.";
  }
  trackTitleDisplay.innerText = "🚨 오류: " + errorMessage;
  player.pause();
  playPauseButton.innerText = "재생";
});
  </script>
<footer style="margin-top:40px;padding:15px;background:#f7f7f7;border-top:1px solid #ddd;font-size:0.9em;color:#555;text-align:center;line-height:1.5;">
  ⓒ Melony. All rights reserved.<br>
  🎵 본 페이지에서 재생되는 모든 음악의 저작권은 <strong>Melony</strong>에게 있으며,<br>
  상업적 이용과 무단 복제를 금하며<br>
  개인적인 감상 목적에 한해 자유롭게 이용하실 수 있습니다.
</footer>
</body>
</html>

