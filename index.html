<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8">
Â  <title>ğŸµ Melony ëœë¤ ìŒì•… í”Œë ˆì´ì–´</title>
Â  <style>
Â  Â  body { font-family: sans-serif; text-align: center; padding: 40px; }
Â  Â  /* ê¸°ë³¸ audio ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìˆ¨ê²¨ì§€ë¯€ë¡œ ì´ ìŠ¤íƒ€ì¼ì€ ë” ì´ìƒ ì§ì ‘ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
Â  Â  /* audio { width: 300px; margin-top: 20px; } */
Â  Â  button { margin-top: 20px; padding: 10px 20px; cursor: pointer; }
    #trackTitle { margin-bottom: 10px; }
    
    /* ì»¤ìŠ¤í…€ ì˜¤ë””ì˜¤ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
    .custom-controls {
        margin-top: 20px;
        display: flex; /* ë²„íŠ¼ì„ ê°€ë¡œë¡œ ì •ë ¬ */
        justify-content: center; /* ê°€ìš´ë° ì •ë ¬ */
        align-items: center;
    }
    .custom-controls button {
        padding: 12px 25px;
        font-size: 18px;
        margin: 0 5px; /* ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
        min-width: 120px; /* ë²„íŠ¼ ë„ˆë¹„ í†µì¼ (ì„ íƒ ì‚¬í•­) */
    }
Â  </style>
  
  <link rel="manifest" href="/manifest.json">
  
</head>
<body>
Â  <h2 id="trackTitle">ğŸµ Melony ëœë¤ ìŒì•… í”Œë ˆì´ì–´</h2>
Â  <audio id="player" playsinline> Â  Â  <source id="source" src="" type="audio/mpeg">
Â  Â  ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
Â  </audio>
Â  <br>

  <div class="custom-controls">
      <button id="playPauseButton">ì¬ìƒ</button>
      <button id="nextButton">ë‹¤ìŒ ê³¡</button>
  </div>

Â  <button id="toggleAuto">ìë™ì¬ìƒ OFF</button>

Â  <script>
const tracks = [
  { id: 1, file: "00C1. Sunday Letters M.mp3", title: "Sunday Letters" },
  { id: 2, file: "00C10. If I Had Said It.mp3", title: "If I Had Said It" },
  { id: 3, file: "00C12. Did You Know I Loved You-M.mp3", title: "Did You Know I Loved You" },
  { id: 4, file: "00C13. Falling in Between - M.mp3", title: "Falling in Between" },
  { id: 5, file: "00C14. The Way We Pause â€“ M.mp3", title: "The Way We Pause" },
  { id: 6, file: "00C15. Shared Mornings.mp3", title: "Shared Mornings" },
  { id: 7, file: "00C16. We Never Said Goodbyeâ€“ M.mp3", title: "We Never Said Goodbye" },
  { id: 8, file: "00C17. Echoes Between Us-M.mp3", title: "Echoes Between Us" },
  { id: 9, file: "00C18. Close Enought.mp3", title: "Close Enought" },
  { id: 10, file: "00C19. If I'm in Your Day.mp3", title: "If I'm in Your Day" },
  { id: 11, file: "00C2. Told with Eyes M.mp3", title: "Told with Eyes" },
  { id: 12, file: "00C20. Steps Between the Silence-M.mp3", title: "Steps Between the Silence" }, // 00C20ìœ¼ë¡œ ìˆ˜ì •
  { id: 13, file: "00C3. Midnight Between Us-M.mp3", title: "Midnight Between Us" },
  { id: 14, file: "00C4. Tilted Heartbeat-M.mp3", title: "Tilted Heartbeat" },
  { id: 15, file: "00C5. Steps That MatchM.mp3", title: "Steps That Match" },
  { id: 16, file: "00C6. Letters in the Rain-M.mp3", title: "Letters in the Rain" },
  { id: 17, file: "00C7. Half a Step Behind-M.mp3", title: "Half a Step Behind" },
  { id: 18, file: "00C8. Almost Something-M.mp3", title: "Almost Something" },
  { id: 19, file: "00C9. Quiet Like a Song-M.mp3", title: "Quiet Like a Song" },
  { id: 20, file: "00D1-Only in My Mind.mp3", title: "Only in My Mind" },
  { id: 21, file: "00D2-What If We Stayed.mp3", title: "What If We Stayed" },
  { id: 22, file: "00D3-Every Time I Almost Spoke.mp3", title: "Every Time I Almost Spoke" },
  { id: 23, file: "00D4-Wish I Said Your Name.mp3", title: "Wish I Said Your Name" },
  { id: 24, file: "00D5-Lines I Never Crossed.mp3", title: "Lines I Never Crossed" },
  { id: 25, file: "00D6-What You Didnâ€™t Say.mp3", title: "What You Didnâ€™t Say" },
  { id: 26, file: "00c11. If You Were Me-M.mp3", title: "If You Were Me" } // 00c11 ì†Œë¬¸ìë¡œ ì‹œì‘í•¨, ê·¸ëŒ€ë¡œ ìœ ì§€
];

    let recent = [];
    const recentLimitMinutes = 30; // 30ë¶„ ì´ë‚´ ì¤‘ë³µ ì¬ìƒ ë°©ì§€
    const autoPlayToggle = document.getElementById("toggleAuto");
    let autoPlay = true; // ìë™ ì¬ìƒ ì´ˆê¸° ìƒíƒœ

    const player = document.getElementById("player");
    const source = document.getElementById("source");
    const trackTitleDisplay = document.getElementById("trackTitle");

    // ìƒˆë¡œìš´ ë³€ìˆ˜ ì„ ì–¸
    const playPauseButton = document.getElementById("playPauseButton");
    const nextButton = document.getElementById("nextButton");

    // ìµœê·¼ ì¬ìƒ ëª©ë¡ì— ì¶”ê°€ (30ë¶„ ì œí•œ ìœ ì§€)
    function saveRecent(id) {
      const now = Date.now();
      recent.push({ id, time: now });
      recent = recent.filter(r => now - r.time <= recentLimitMinutes * 60 * 1000);
      console.log("Recent tracks:", recent.map(r => r.id));
    }

    // ì¬ìƒ ê°€ëŠ¥í•œ íŠ¸ë™ ì¤‘ ëœë¤ìœ¼ë¡œ í•˜ë‚˜ ì„ íƒ
    function pickRandomTrack() {
      const available = tracks.filter(t => !recent.some(r => r.id === t.id));
      
      if (available.length === 0) {
        console.log("All tracks played recently. Resetting recent history.");
        recent = [];
        return pickRandomTrack();
      }
      
      const index = Math.floor(Math.random() * available.length);
      return available[index];
    }

    // íŠ¸ë™ ë¡œë“œ ë° ì¬ìƒ
    function loadTrack(track) {
      trackTitleDisplay.innerText = "ğŸµ " + track.title;
      source.src = track.file;
      player.load();
      
      // íŠ¸ë™ ë¡œë“œ í›„ UI ì—…ë°ì´íŠ¸: player.paused ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì„¤ì •
      // play()ëŠ” ë¹„ë™ê¸°ì´ë¯€ë¡œ, í˜¸ì¶œ í›„ ë°”ë¡œ 'ì¼ì‹œì •ì§€'ë¡œ ë°”ê¾¸ê¸°ë³´ë‹¤
      // 'play' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì—ì„œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ë” ì •í™•í•©ë‹ˆë‹¤.
      playPauseButton.innerText = player.paused ? "ì¬ìƒ" : "ì¼ì‹œì •ì§€";


      if (autoPlay) {
        const playPromise = player.play();
        if (playPromise !== undefined) {
          playPromise.then(() => {
            // ì¬ìƒ ì„±ê³µ - 'play' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì—ì„œ ë²„íŠ¼ í…ìŠ¤íŠ¸ê°€ ì—…ë°ì´íŠ¸ë¨
          }).catch(error => {
            // ì¬ìƒ ì‹¤íŒ¨ (ì˜ˆ: ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì—†ìŒ)
            console.warn("Autoplay was prevented:", error);
            // ìë™ ì¬ìƒ ì‹¤íŒ¨ ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ëŠ” 'ì¬ìƒ'ìœ¼ë¡œ ìœ ì§€ë˜ì–´ì•¼ í•¨
            playPauseButton.innerText = "ì¬ìƒ"; 
          });
        }
      }
      saveRecent(track.id);
      console.log("Loaded track:", track.title, "File:", track.file);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° íŠ¸ë™ ì„¤ì •
    document.addEventListener("DOMContentLoaded", () => {
      const firstTrack = pickRandomTrack();
      loadTrack(firstTrack);
    });

    // í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ê³¡ì´ ëë‚˜ë©´ ë‹¤ìŒ ëœë¤ ê³¡ ì¬ìƒ
    player.addEventListener("ended", () => {
      console.log("Track ended. Loading next random track.");
      const nextTrack = pickRandomTrack();
      loadTrack(nextTrack);
    });

    // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ìƒíƒœ ë³€ê²½ ê°ì§€ (ì¬ìƒ, ì¼ì‹œì •ì§€ ë“±)
    player.addEventListener('play', () => {
        playPauseButton.innerText = "ì¼ì‹œì •ì§€";
    });
    player.addEventListener('pause', () => {
        playPauseButton.innerText = "ì¬ìƒ";
    });

    // --- ìƒˆë¡œìš´ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---

    // ì¬ìƒ/ì¼ì‹œì •ì§€ ë²„íŠ¼
    playPauseButton.addEventListener("click", () => {
        if (player.paused) {
            const playPromise = player.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // ì„±ê³µì ìœ¼ë¡œ ì¬ìƒ ì‹œì‘ - 'play' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì—ì„œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                }).catch(error => {
                    console.warn("Play attempt failed:", error);
                });
            }
        } else {
            player.pause();
            // 'pause' ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì—ì„œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        }
    });

    // ë‹¤ìŒ ê³¡ ë²„íŠ¼
    nextButton.addEventListener("click", () => {
        const nextTrack = pickRandomTrack();
        loadTrack(nextTrack);
    });

    // ìë™ì¬ìƒ í† ê¸€
    autoPlayToggle.addEventListener("click", () => {
      autoPlay = !autoPlay;
      autoPlayToggle.innerText = autoPlay ? "ìë™ì¬ìƒ OFF" : "ìë™ì¬ìƒ ON";
      console.log("Autoplay is now:", autoPlay ? "ON" : "OFF");
      
      if (autoPlay && player.paused) {
        const playPromise = player.play();
        if (playPromise !== undefined) {
          playPromise.then(() => {
            console.log("Attempted to play after autoplay toggle.");
          }).catch(error => {
            console.warn("Play attempt after toggle was prevented:", error);
          });
        }
      }
    });

    // ì˜¤ë””ì˜¤ ë¡œë”© ì—ëŸ¬ í•¸ë“¤ë§ (íŒŒì¼ì„ ëª» ì°¾ê±°ë‚˜ ì¬ìƒí•  ìˆ˜ ì—†ì„ ë•Œ)
    player.addEventListener('error', (e) => {
        console.error("Audio error!", e);
        let errorMessage = "ì˜¤ë””ì˜¤ ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        if (e.target.error.code === 4) {
            errorMessage = "ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë¸Œë¼ìš°ì €ê°€ ì§€ì›í•˜ì§€ ì•ŠëŠ” í˜•ì‹ì…ë‹ˆë‹¤.";
        }
        trackTitleDisplay.innerText = "ğŸš¨ ì˜¤ë¥˜: " + errorMessage;
        player.pause();
        playPauseButton.innerText = "ì¬ìƒ"; // ì˜¤ë¥˜ ì‹œ ì¬ìƒ ë²„íŠ¼ìœ¼ë¡œ ë˜ëŒë¦¼
    });

Â  </script>
</body>
</html>
